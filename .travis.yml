# This is a weird way of telling Travis to use the fast container-based test
# runner instead of the slow VM-based runner.
sudo: false

language: go

go:
    - "1.10"

# Only clone the most recent commit.
git:
    depth: 1

before_install:
    #- go get -t ./...
    - go get -u golang.org/x/vgo
    - go install ./vendor/github.com/golangci/golangci-lint/cmd/golangci-lint
    - vgo mod -vendor

#install:
#    - go get github.com/perlin-network/noise

# Skip the install step. Don't `go get` dependencies. Only build with the code
# in vendor/
install: true

# script always runs to completion (set +e). If we have linter issues AND a
# failing test, we want to see both. Configure golangci-lint with a
# .golangci.yml file at the top level of your repo.
script:
    - golangci-lint run       # run a bunch of code checkers/linters in parallel
    - vgo test -coverprofile=coverage.txt -covermode=atomic -bench -race .

after_success:
    - bash <(curl -s https://codecov.io/bash)
